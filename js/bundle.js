const TYPE=Object.freeze({SINGLE_NOTE:0,INTERVAL:1,CHORD:2});const INSTRUMENT=Object.freeze({ALL:0,PIANO:1,GUITAR:2});const DURATION=Object.freeze({FIVE_MINUTE:1,TEN_MINUTES:10,FIFTEEN_MINUTES:15,TWENTY_MINUTES:20,THIRTY_MINUTES:30,FORTY_FIVE_MINUTES:45,SIXTY_MINUTES:60,INFINITE:-1});const DISPLAY_DIAGRAM=Object.freeze({PIANO:1,GUITAR:2});const MAX_BPM=15;const MIN_BPM=3;var all_notes=[];var is_left_column_showing=true;var model={duration:DURATION.THIRTY_MINUTES,BPM:15,volume:1,instrument:INSTRUMENT.ALL,speak:true,speak_volume:1,display_diagrams:[],range:{min:40,max:84},single_notes:{enabled:true},interval:{enabled:false,types:[],play_types:[]},chords:{enabled:false,three_note_types:[],three_note_inversion_types:[],four_note_types:[],four_note_inversion_types:[],play_types:[]},beat_division:1,time_signature:2};Number.prototype.to_percent=function(min,max){return 100*(this-min)/(max-min)};Array.prototype.remove=function(){var what,a=arguments,L=a.length,ax;while(L&&this.length){what=a[--L];while((ax=this.indexOf(what))!==-1){this.splice(ax,1)}}return this};function $(id){return document.getElementById(id)}function randomInteger(min,max){return Math.floor(Math.random()*(max-min+1)+min)}function isFirefox(){function checkBrowser(){c=navigator.userAgent.search("Chrome");f=navigator.userAgent.search("Firefox");m8=navigator.userAgent.search("MSIE 8.0");m9=navigator.userAgent.search("MSIE 9.0");if(c>-1){browser="Chrome"}else if(f>-1){browser="Firefox"}else if(m9>-1){browser="MSIE 9.0"}else if(m8>-1){browser="MSIE 8.0"}else{browser="Other - Safari"}return browser}return checkBrowser()==="Firefox"}function is_compact_window(){return window.innerWidth<=800||window.innerHeight<=500}var isSafari=navigator.vendor&&navigator.vendor.indexOf("Apple")>-1&&navigator.userAgent&&navigator.userAgent.indexOf("CriOS")==-1&&navigator.userAgent.indexOf("FxiOS")==-1;window.mobileCheck=function(){let check=false;(function(a){if(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(a)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(a.substr(0,4)))check=true})(navigator.userAgent||navigator.vendor||window.opera);return check};window.mobileAndTabletCheck=function(){let check=false;(function(a){if(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino|android|ipad|playbook|silk/i.test(a)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(a.substr(0,4)))check=true})(navigator.userAgent||navigator.vendor||window.opera);return check};function isFromHomeScreen(){const params=new URLSearchParams(window.location.search);return params.has("from")}function openURL(url){window.open(url,"_blank")}function BPMtoMilliSeconds(BPM){return 1e3/(BPM/60)}var storage={};storage.load=function(){model.duration=storage.get_duration(DURATION.TEN_MINUTES);model.instrument=storage.get_instrument(INSTRUMENT.PIANO);model.BPM=storage.get_BPM(8);model.volume=storage.get_volume(.1);model.speak=storage.get_speak(true);model.speak_volume=storage.get_speak_volume(.25);model.single_notes.enabled=storage.get_single_notes(true);loadInstrumentDisplayDiagramData();function loadInstrumentDisplayDiagramData(){if(storage.get_instrument_display_piano(true))model.display_diagrams.push(DISPLAY_DIAGRAM.PIANO);if(storage.get_instrument_display_guitar(true))model.display_diagrams.push(DISPLAY_DIAGRAM.GUITAR)}loadIntervalData();function loadIntervalData(){model.interval.enabled=storage.get_intervals(true);let INTERVAL_TYPE=musicKit.Interval.TYPE;if(storage.get_minor_second(true))model.interval.types.push(INTERVAL_TYPE.MINOR_SECOND);if(storage.get_major_second(true))model.interval.types.push(INTERVAL_TYPE.MAJOR_SECOND);if(storage.get_minor_third(true))model.interval.types.push(INTERVAL_TYPE.MINOR_THIRD);if(storage.get_major_third(true))model.interval.types.push(INTERVAL_TYPE.MAJOR_THIRD);if(storage.get_perfect_fourth(true))model.interval.types.push(INTERVAL_TYPE.PERFECT_FOURTH);if(storage.get_tritone(true))model.interval.types.push(INTERVAL_TYPE.TRITONE);if(storage.get_perfect_fifth(true))model.interval.types.push(INTERVAL_TYPE.PERFECT_FIFTH);if(storage.get_minor_sixth(true))model.interval.types.push(INTERVAL_TYPE.MINOR_SIXTH);if(storage.get_major_sixth(true))model.interval.types.push(INTERVAL_TYPE.MAJOR_SIXTH);if(storage.get_minor_seventh(true))model.interval.types.push(INTERVAL_TYPE.MINOR_SEVENTH);if(storage.get_major_seventh(true))model.interval.types.push(INTERVAL_TYPE.MAJOR_SEVENTH);if(storage.get_octave(true))model.interval.types.push(INTERVAL_TYPE.OCTAVE);let INTERVAL_PLAY_TYPE=musicKit.Interval.PLAY_TYPE;if(storage.get_ascending(true))model.interval.play_types.push(INTERVAL_PLAY_TYPE.ASCENDING);if(storage.get_descending(true))model.interval.play_types.push(INTERVAL_PLAY_TYPE.DESCENDING);if(storage.get_harmonic(false))model.interval.play_types.push(INTERVAL_PLAY_TYPE.HARMONIC)}loadChordData();function loadChordData(){model.chords.enabled=storage.get_chords(true);let CHORD_TYPE=musicKit.Chord.TYPE;if(storage.get_chords_major(true))model.chords.three_note_types.push(CHORD_TYPE.Major);if(storage.get_chords_minor(true))model.chords.three_note_types.push(CHORD_TYPE.minor);if(storage.get_chords_augmented(false))model.chords.three_note_types.push(CHORD_TYPE.Aug);if(storage.get_chords_diminished(false))model.chords.three_note_types.push(CHORD_TYPE.Dim);if(storage.get_chords_major7(false))model.chords.four_note_types.push(CHORD_TYPE.Major7);if(storage.get_chords_minor7(false))model.chords.four_note_types.push(CHORD_TYPE.minor7);if(storage.get_chords_dominant7(false))model.chords.four_note_types.push(CHORD_TYPE.Dom7);let CHORD_INVERSION_TYPE=musicKit.Chord.INVERSION_TYPE;if(storage.get_chords_three_note_inversion_root(true))model.chords.three_note_inversion_types.push(CHORD_INVERSION_TYPE.Root);if(storage.get_chords_three_note_inversion_first(false))model.chords.three_note_inversion_types.push(CHORD_INVERSION_TYPE.First);if(storage.get_chords_three_note_inversion_second(false))model.chords.three_note_inversion_types.push(CHORD_INVERSION_TYPE.Second);if(storage.get_chords_major_seven(false))model.chords.four_note_types.push(CHORD_TYPE.Major7);if(storage.get_chords_minor_seven(false))model.chords.four_note_types.push(CHORD_TYPE.minor7);if(storage.get_chords_dominant_seven(false))model.chords.four_note_types.push(CHORD_TYPE.Dom7);if(storage.get_chords_four_note_inversion_root(true))model.chords.four_note_inversion_types.push(CHORD_INVERSION_TYPE.Root);if(storage.get_chords_four_note_inversion_first(false))model.chords.four_note_inversion_types.push(CHORD_INVERSION_TYPE.First);if(storage.get_chords_four_note_inversion_second(false))model.chords.four_note_inversion_types.push(CHORD_INVERSION_TYPE.Second);if(storage.get_chords_four_note_inversion_second(false))model.chords.four_note_inversion_types.push(CHORD_INVERSION_TYPE.Third);let CHORD_PLAY_TYPE=musicKit.Chord.PLAY_TYPE;if(storage.get_chords_harmonic(true))model.chords.play_types.push(CHORD_PLAY_TYPE.HARMONIC);if(storage.get_chords_arpeggiate(false))model.chords.play_types.push(CHORD_PLAY_TYPE.ARPEGGIATE)}};storage.BPM_KEY="EAR_TRAINER_BPM_KEY";storage.get_BPM=function(default_value){return parseInt(storage.get(storage.BPM_KEY,default_value))};storage.set_BPM=function(value){localStorage.setItem(storage.BPM_KEY,value)};storage.DURATION_KEY="EAR_TRAINER_DURATION_KEY";storage.get_duration=function(default_value){return parseFloat(storage.get(storage.DURATION_KEY,default_value))};storage.set_duration=function(value){localStorage.setItem(storage.DURATION_KEY,value)};storage.INSTRUMENT_KEY="EAR_TRAINER_INSTRUMENT_KEY";storage.get_instrument=function(default_value){return parseFloat(storage.get(storage.INSTRUMENT_KEY,default_value))};storage.set_instrument=function(value){localStorage.setItem(storage.INSTRUMENT_KEY,value)};storage.VOLUME_KEY="EAR_TRAINER_VOLUME_KEY";storage.get_volume=function(default_value){return parseFloat(storage.get(storage.VOLUME_KEY,default_value))};storage.set_volume=function(value){localStorage.setItem(storage.VOLUME_KEY,value)};storage.SPEAK="EAR_TRAINER_SPEAK";storage.get_speak=function(default_value){var value=storage.get(storage.SPEAK,default_value);return Boolean(value==="true"||value===true)};storage.set_speak=function(value){localStorage.setItem(storage.SPEAK,value)};storage.SPEAK_VOLUME_KEY="EAR_TRAINER_SPEAK_VOLUME_KEY";storage.get_speak_volume=function(default_value){return parseFloat(storage.get(storage.SPEAK_VOLUME_KEY,default_value))};storage.set_speak_volume=function(value){localStorage.setItem(storage.SPEAK_VOLUME_KEY,value)};storage.set_display_diagrams=function(display_type,value){switch(display_type){case DISPLAY_DIAGRAM.PIANO:storage.set_instrument_display_piano(value);break;case DISPLAY_DIAGRAM.GUITAR:storage.set_instrument_display_guitar(value);break}};storage.INSTRUMENT_DISPLAY_PIANO="EAR_TRAINER_INSTRUMENT_DISPLAY_PIANO";storage.get_instrument_display_piano=function(default_value){var value=storage.get(storage.INSTRUMENT_DISPLAY_PIANO,default_value);return Boolean(value==="true"||value===true)};storage.set_instrument_display_piano=function(value){localStorage.setItem(storage.INSTRUMENT_DISPLAY_PIANO,value)};storage.INSTRUMENT_DISPLAY_GUITAR="EAR_TRAINER_INSTRUMENT_DISPLAY_GUITAR";storage.get_instrument_display_guitar=function(default_value){var value=storage.get(storage.INSTRUMENT_DISPLAY_GUITAR,default_value);return Boolean(value==="true"||value===true)};storage.set_instrument_display_guitar=function(value){localStorage.setItem(storage.INSTRUMENT_DISPLAY_GUITAR,value)};storage.SINGLE_NOTES="EAR_TRAINER_SINGLE_NOTES";storage.get_single_notes=function(default_value){var value=storage.get(storage.SINGLE_NOTES,default_value);return Boolean(value==="true"||value===true)};storage.set_single_notes=function(value){localStorage.setItem(storage.SINGLE_NOTES,value)};storage.INTERVALS="EAR_TRAINER_INTERVALS";storage.get_intervals=function(default_value){var value=storage.get(storage.INTERVALS,default_value);return Boolean(value==="true"||value===true)};storage.set_intervals=function(value){localStorage.setItem(storage.INTERVALS,value)};storage.set_interval_type=function(interval_type,value){let INTERVAL_TYPE=musicKit.Interval.TYPE;switch(interval_type){case INTERVAL_TYPE.MINOR_SECOND:storage.set_minor_second(value);break;case INTERVAL_TYPE.MAJOR_SECOND:storage.set_major_second(value);break;case INTERVAL_TYPE.MINOR_THIRD:storage.set_minor_third(value);break;case INTERVAL_TYPE.MAJOR_THIRD:storage.set_major_third(value);break;case INTERVAL_TYPE.PERFECT_FOURTH:storage.set_perfect_fourth(value);break;case INTERVAL_TYPE.TRITONE:storage.set_tritone(value);break;case INTERVAL_TYPE.PERFECT_FIFTH:storage.set_perfect_fifth(value);break;case INTERVAL_TYPE.MINOR_SIXTH:storage.set_minor_sixth(value);break;case INTERVAL_TYPE.MAJOR_SIXTH:storage.set_major_sixth(value);break;case INTERVAL_TYPE.MINOR_SEVENTH:storage.set_minor_seventh(value);break;case INTERVAL_TYPE.MAJOR_SEVENTH:storage.set_major_seventh(value);break;case INTERVAL_TYPE.OCTAVE:storage.set_octave(value);break}};storage.MINOR_SECOND="EAR_TRAINER_MINOR_SECOND";storage.get_minor_second=function(default_value){var value=storage.get(storage.MINOR_SECOND,default_value);return Boolean(value==="true"||value===true)};storage.set_minor_second=function(value){localStorage.setItem(storage.MINOR_SECOND,value)};storage.MAJOR_SECOND="EAR_TRAINER_MAJOR_SECOND";storage.get_major_second=function(default_value){var value=storage.get(storage.MAJOR_SECOND,default_value);return Boolean(value==="true"||value===true)};storage.set_major_second=function(value){localStorage.setItem(storage.MAJOR_SECOND,value)};storage.MINOR_THIRD="EAR_TRAINER_MINOR_THIRD";storage.get_minor_third=function(default_value){var value=storage.get(storage.MINOR_THIRD,default_value);return Boolean(value==="true"||value===true)};storage.set_minor_third=function(value){localStorage.setItem(storage.MINOR_THIRD,value)};storage.MAJOR_THIRD="EAR_TRAINER_MAJOR_THIRD";storage.get_major_third=function(default_value){var value=storage.get(storage.MAJOR_THIRD,default_value);return Boolean(value==="true"||value===true)};storage.set_major_third=function(value){localStorage.setItem(storage.MAJOR_THIRD,value)};storage.PERFECT_FOURTH="EAR_TRAINER_PERFECT_FOURTH";storage.get_perfect_fourth=function(default_value){var value=storage.get(storage.PERFECT_FOURTH,default_value);return Boolean(value==="true"||value===true)};storage.set_perfect_fourth=function(value){localStorage.setItem(storage.PERFECT_FOURTH,value)};storage.TRITONE="EAR_TRAINER_TRITONE";storage.get_tritone=function(default_value){var value=storage.get(storage.TRITONE,default_value);return Boolean(value==="true"||value===true)};storage.set_tritone=function(value){localStorage.setItem(storage.TRITONE,value)};storage.PERFECT_FIFTH="EAR_TRAINER_PERFECT_FIFTH";storage.get_perfect_fifth=function(default_value){var value=storage.get(storage.PERFECT_FIFTH,default_value);return Boolean(value==="true"||value===true)};storage.set_perfect_fifth=function(value){localStorage.setItem(storage.PERFECT_FIFTH,value)};storage.MINOR_SIXTH="EAR_TRAINER_MINOR_SIXTH";storage.get_minor_sixth=function(default_value){var value=storage.get(storage.MINOR_SIXTH,default_value);return Boolean(value==="true"||value===true)};storage.set_minor_sixth=function(value){localStorage.setItem(storage.MINOR_SIXTH,value)};storage.MAJOR_SIXTH="EAR_TRAINER_MAJOR_SIXTH";storage.get_major_sixth=function(default_value){var value=storage.get(storage.MAJOR_SIXTH,default_value);return Boolean(value==="true"||value===true)};storage.set_major_sixth=function(value){localStorage.setItem(storage.MAJOR_SIXTH,value)};storage.MINOR_SEVENTH="EAR_TRAINER_MINOR_SEVENTH";storage.get_minor_seventh=function(default_value){var value=storage.get(storage.MINOR_SEVENTH,default_value);return Boolean(value==="true"||value===true)};storage.set_minor_seventh=function(value){localStorage.setItem(storage.MINOR_SEVENTH,value)};storage.MAJOR_SEVENTH="EAR_TRAINER_MAJOR_SEVENTH";storage.get_major_seventh=function(default_value){var value=storage.get(storage.MAJOR_SEVENTH,default_value);return Boolean(value==="true"||value===true)};storage.set_major_seventh=function(value){localStorage.setItem(storage.MAJOR_SEVENTH,value)};storage.OCTAVE="EAR_TRAINER_OCTAVE";storage.get_octave=function(default_value){var value=storage.get(storage.OCTAVE,default_value);return Boolean(value==="true"||value===true)};storage.set_octave=function(value){localStorage.setItem(storage.OCTAVE,value)};storage.set_interval_play_type=function(interval_play_type,value){let INTERVAL_PLAY_TYPE=musicKit.Interval.PLAY_TYPE;switch(interval_play_type){case INTERVAL_PLAY_TYPE.ASCENDING:storage.set_ascending(value);break;case INTERVAL_PLAY_TYPE.DESCENDING:storage.set_descending(value);break;case INTERVAL_PLAY_TYPE.HARMONIC:storage.set_harmonic(value);break}};storage.ASCENDING="EAR_TRAINER_ASCENDING";storage.get_ascending=function(default_value){var value=storage.get(storage.ASCENDING,default_value);return Boolean(value==="true"||value===true)};storage.set_ascending=function(value){localStorage.setItem(storage.ASCENDING,value)};storage.DESCENDING="EAR_TRAINER_DESCENDING";storage.get_descending=function(default_value){var value=storage.get(storage.DESCENDING,default_value);return Boolean(value==="true"||value===true)};storage.set_descending=function(value){localStorage.setItem(storage.DESCENDING,value)};storage.HARMONIC="EAR_TRAINER_HARMONIC";storage.get_harmonic=function(default_value){var value=storage.get(storage.HARMONIC,default_value);return Boolean(value==="true"||value===true)};storage.set_harmonic=function(value){localStorage.setItem(storage.HARMONIC,value)};storage.CHORDS="EAR_TRAINER_CHORDS";storage.get_chords=function(default_value){var value=storage.get(storage.CHORDS,default_value);return Boolean(value==="true"||value===true)};storage.set_chords=function(value){localStorage.setItem(storage.CHORDS,value)};storage.set_chord_three_note_type=function(type,value){let CHORD_TYPE=musicKit.Chord.TYPE;switch(type){case CHORD_TYPE.Major:storage.set_chords_major(value);break;case CHORD_TYPE.minor:storage.set_chords_minor(value);break;case CHORD_TYPE.Aug:storage.set_chords_augmented(value);break;case CHORD_TYPE.Dim:storage.set_chords_diminished(value);break;case CHORD_TYPE.Major7:storage.set_chords_major7(value);break;case CHORD_TYPE.minor7:storage.set_chords_minor7(value);break;case CHORD_TYPE.Dom7:storage.set_chords_dominant7(value);break}};storage.CHORD_MAJOR="EAR_TRAINER_CHORD_MAJOR";storage.get_chords_major=function(default_value){var value=storage.get(storage.CHORD_MAJOR,default_value);return Boolean(value==="true"||value===true)};storage.set_chords_major=function(value){localStorage.setItem(storage.CHORD_MAJOR,value)};storage.CHORD_MINOR="EAR_TRAINER_CHORD_MINOR";storage.get_chords_minor=function(default_value){var value=storage.get(storage.CHORD_MINOR,default_value);return Boolean(value==="true"||value===true)};storage.set_chords_minor=function(value){localStorage.setItem(storage.CHORD_MINOR,value)};storage.CHORD_AUG="EAR_TRAINER_CHORD_AUG";storage.get_chords_augmented=function(default_value){var value=storage.get(storage.CHORD_AUG,default_value);return Boolean(value==="true"||value===true)};storage.set_chords_augmented=function(value){localStorage.setItem(storage.CHORD_AUG,value)};storage.CHORD_DIM="EAR_TRAINER_CHORD_DIM";storage.get_chords_diminished=function(default_value){var value=storage.get(storage.CHORD_DIM,default_value);return Boolean(value==="true"||value===true)};storage.set_chords_diminished=function(value){localStorage.setItem(storage.CHORD_DIM,value)};storage.CHORD_MAJ7="EAR_TRAINER_CHORD_MAJ7";storage.get_chords_major7=function(default_value){var value=storage.get(storage.CHORD_MAJ7,default_value);return Boolean(value==="true"||value===true)};storage.set_chords_major7=function(value){localStorage.setItem(storage.CHORD_MAJ7,value)};storage.CHORD_MIN7="EAR_TRAINER_CHORD_MIN7";storage.get_chords_minor7=function(default_value){var value=storage.get(storage.CHORD_MIN7,default_value);return Boolean(value==="true"||value===true)};storage.set_chords_minor7=function(value){localStorage.setItem(storage.CHORD_MIN7,value)};storage.CHORD_DOM7="EAR_TRAINER_CHORD_DOM7";storage.get_chords_dominant7=function(default_value){var value=storage.get(storage.CHORD_DOM7,default_value);return Boolean(value==="true"||value===true)};storage.set_chords_dominant7=function(value){localStorage.setItem(storage.CHORD_DOM7,value)};storage.set_chord_three_note_inversion_type=function(type,value){let CHORD_INVERSION_TYPE=musicKit.Chord.INVERSION_TYPE;switch(type){case CHORD_INVERSION_TYPE.Root:storage.set_chords_three_note_inversion_root(value);break;case CHORD_INVERSION_TYPE.First:storage.set_chords_three_note_inversion_first(value);break;case CHORD_INVERSION_TYPE.Second:storage.set_chords_three_note_inversion_second(value);break}};storage.CHORD_THREE_NOTE_ROOT="EAR_TRAINER_CHORD_THREE_NOTE_ROOT";storage.get_chords_three_note_inversion_root=function(default_value){var value=storage.get(storage.CHORD_THREE_NOTE_ROOT,default_value);return Boolean(value==="true"||value===true)};storage.set_chords_three_note_inversion_root=function(value){localStorage.setItem(storage.CHORD_THREE_NOTE_ROOT,value)};storage.CHORD_THREE_NOTE_FIRST="EAR_TRAINER_CHORD_THREE_NOTE_FIRST";storage.get_chords_three_note_inversion_first=function(default_value){var value=storage.get(storage.CHORD_THREE_NOTE_FIRST,default_value);return Boolean(value==="true"||value===true)};storage.set_chords_three_note_inversion_first=function(value){localStorage.setItem(storage.CHORD_THREE_NOTE_FIRST,value)};storage.CHORD_THREE_NOTE_SECOND="EAR_TRAINER_CHORD_THREE_NOTE_SECOND";storage.get_chords_three_note_inversion_second=function(default_value){var value=storage.get(storage.CHORD_THREE_NOTE_SECOND,default_value);return Boolean(value==="true"||value===true)};storage.set_chords_three_note_inversion_second=function(value){localStorage.setItem(storage.CHORD_THREE_NOTE_SECOND,value)};storage.set_chord_four_note_type=function(type,value){let CHORD_TYPE=musicKit.Chord.TYPE;switch(type){case CHORD_TYPE.Major7:storage.set_chords_major_seven(value);break;case CHORD_TYPE.minor7:storage.set_chords_minor_seven(value);break;case CHORD_TYPE.Dom7:storage.set_chords_dominant_seven(value);break}};storage.CHORD_MAJOR_SEVEN="EAR_TRAINER_CHORD_MAJOR_SEVEN";storage.get_chords_major_seven=function(default_value){var value=storage.get(storage.CHORD_MAJOR_SEVEN,default_value);return Boolean(value==="true"||value===true)};storage.set_chords_major_seven=function(value){localStorage.setItem(storage.CHORD_MAJOR_SEVEN,value)};storage.CHORD_MINOR_SEVEN="EAR_TRAINER_CHORD_MINOR_SEVEN";storage.get_chords_minor_seven=function(default_value){var value=storage.get(storage.CHORD_MINOR_SEVEN,default_value);return Boolean(value==="true"||value===true)};storage.set_chords_minor_seven=function(value){localStorage.setItem(storage.CHORD_MINOR_SEVEN,value)};storage.CHORD_DOM_SEVEN="EAR_TRAINER_CHORD_DOM_SEVEN";storage.get_chords_dominant_seven=function(default_value){var value=storage.get(storage.CHORD_DOM_SEVEN,default_value);return Boolean(value==="true"||value===true)};storage.set_chords_dominant_seven=function(value){localStorage.setItem(storage.CHORD_DOM_SEVEN,value)};storage.set_chord_four_note_inversion_type=function(type,value){let CHORD_INVERSION_TYPE=musicKit.Chord.INVERSION_TYPE;switch(type){case CHORD_INVERSION_TYPE.Root:storage.set_chords_four_note_inversion_root(value);break;case CHORD_INVERSION_TYPE.First:storage.set_chords_four_note_inversion_first(value);break;case CHORD_INVERSION_TYPE.Second:storage.set_chords_four_note_inversion_second(value);break;case CHORD_INVERSION_TYPE.Third:storage.set_chords_four_note_inversion_second(value);break}};storage.CHORD_FOUR_NOTE_ROOT="EAR_TRAINER_CHORD_FOUR_NOTE_ROOT";storage.get_chords_four_note_inversion_root=function(default_value){var value=storage.get(storage.CHORD_FOUR_NOTE_ROOT,default_value);return Boolean(value==="true"||value===true)};storage.set_chords_four_note_inversion_root=function(value){localStorage.setItem(storage.CHORD_FOUR_NOTE_ROOT,value)};storage.CHORD_FOUR_NOTE_FIRST="EAR_TRAINER_CHORD_FOUR_NOTE_FIRST";storage.get_chords_four_note_inversion_first=function(default_value){var value=storage.get(storage.CHORD_FOUR_NOTE_FIRST,default_value);return Boolean(value==="true"||value===true)};storage.set_chords_four_note_inversion_first=function(value){localStorage.setItem(storage.CHORD_FOUR_NOTE_FIRST,value)};storage.CHORD_FOUR_NOTE_SECOND="EAR_TRAINER_CHORD_FOUR_NOTE_SECOND";storage.get_chords_four_note_inversion_second=function(default_value){var value=storage.get(storage.CHORD_FOUR_NOTE_SECOND,default_value);return Boolean(value==="true"||value===true)};storage.set_chords_four_note_inversion_second=function(value){localStorage.setItem(storage.CHORD_FOUR_NOTE_SECOND,value)};storage.CHORD_FOUR_NOTE_THIRD="EAR_TRAINER_CHORD_FOUR_NOTE_THIRD";storage.get_chords_four_note_inversion_second=function(default_value){var value=storage.get(storage.CHORD_FOUR_NOTE_THIRD,default_value);return Boolean(value==="true"||value===true)};storage.set_chords_four_note_inversion_second=function(value){localStorage.setItem(storage.CHORD_FOUR_NOTE_THIRD,value)};storage.set_chord_play_type=function(play_type,value){let CHORD_PLAY_TYPE=musicKit.Chord.PLAY_TYPE;switch(play_type){case CHORD_PLAY_TYPE.ARPEGGIATE:storage.set_chords_arpeggiate(value);break;case CHORD_PLAY_TYPE.HARMONIC:storage.set_chords_harmonic(value);break}};storage.ARPEGGIATE="EAR_TRAINER_ARPEGGIATE";storage.get_chords_arpeggiate=function(default_value){var value=storage.get(storage.ARPEGGIATE,default_value);return Boolean(value==="true"||value===true)};storage.set_chords_arpeggiate=function(value){localStorage.setItem(storage.ARPEGGIATE,value)};storage.CHORDS_HARMONIC="EAR_TRAINER_CHORDS_HARMONIC";storage.get_chords_harmonic=function(default_value){var value=storage.get(storage.CHORDS_HARMONIC,default_value);return Boolean(value==="true"||value===true)};storage.set_chords_harmonic=function(value){localStorage.setItem(storage.CHORDS_HARMONIC,value)};storage.get=function(key,default_value){let result=localStorage.getItem(key);return result==undefined?default_value:result};function isDurationExpired(){if(!isDurationInfinte()){var running_time=new Date-audio_controller.start_time;var durationInMS=getDurationInMS();if(running_time>durationInMS){log.i("Duration expired");return true}}return false;function isDurationInfinte(){return model.duration==DURATION.INFINITE}function getDurationInMS(){return model.duration*6e4}}function reloadActivePlayer(){if(audio_controller.playing){audio_controller.model_changed=true}}var new_beat_division=0;function reloadDivisions(value){if(audio_controller.playing){audio_controller.divisions_changed=true;new_beat_division=value}else{model.beat_division=value}}function reloadBPM(value){if(audio_controller.playing){audio_controller.bpm_changed=true}}function forcePlay(){audio_controller.pause();update_UI_stopped();audio_controller.play();update_UI_playing()}function forceStop(){var was_playing=false;if(audio_controller.playing){audio_controller.playPause();update_UI_stopped();was_playing=true}return was_playing}function playPause(){var loading=midi_controller.load();var j;for(j=0;j<5;j++){audio_controller.preloaded_audio[j]=document.createElement("AUDIO")}if(loading){setTimeout(function(){log.i("delayed execution for midi loading");continuePlay()},500)}else{continuePlay()}function continuePlay(){var audio_is_playing=audio_controller.playPause();if(audio_is_playing)update_UI_playing();else update_UI_stopped()}}var audio_controller={index:0,start_time:0,note:{},interval:{},chord:{},preloaded_audio:[],playing:false,timer_id:{},audio_queue:[],text_queue:[],model_changed:false,divisions_changed:false,bpm_changed:false,gain_node:{},context:{}};audio_controller.reloadDuration=function(){audio_controller.start_time=new Date};audio_controller.setInstrument=function(instrument){};audio_controller.playPause=function(){if(this.playing)this.pause();else this.play(model);return this.playing};audio_controller.pause=function(){if(this.playing)clearInterval(audio_controller.timer_id);this.playing=false};audio_controller.play=function(){audio_controller.start_time=new Date;audio_controller.index=1;this.playing=true;var audio_queue_index=0;function BPMtoMilliSeconds(BPM){return 1e3/(BPM/60)}var time_division_milli_seconds=BPMtoMilliSeconds(model.BPM)/model.beat_division;audio_controller.executeAudioTimer(audio_queue_index,this.accent_audio,this.audio_queue,this.text_queue);var interval=time_division_milli_seconds;var expected=Date.now()+interval;audio_controller.timer_id=setTimeout(step,interval);function step(){if(isDurationExpired()&&audio_controller.index%2!=0){log.i("force close");clearInterval(audio_controller.timer_id);forceStop();update_UI_stopped();hideAnswer();if(model.speak)playFile("audio/exercise_completed.mp3");return}var drift=Date.now()-expected;if(drift>interval){log.e("something really bad happened. Maybe the browser (tab) was inactive? possibly special handling to avoid futile 'catch up' run");audio_controller.pause()}audio_queue_index=(audio_queue_index+1)%audio_controller.audio_queue.length;if(audio_controller.model_changed){audio_controller.model_changed=false;forcePlay()}else{var time_division_milli_seconds=BPMtoMilliSeconds(model.BPM)/model.beat_division;audio_controller.executeAudioTimer(audio_queue_index,audio_controller.accent_audio,audio_controller.audio_queue,audio_controller.text_queue,time_division_milli_seconds);if(audio_controller.bpm_changed){audio_controller.bpm_changed=false;var time_division_milli_seconds=BPMtoMilliSeconds(model.BPM)/model.beat_division;interval=time_division_milli_seconds;expected=Date.now()+interval;audio_controller.timer_id=setTimeout(step,interval)}else if(audio_queue_index%model.beat_division==0&&audio_controller.divisions_changed){audio_controller.divisions_changed=false;var old_length=audio_controller.audio_queue.length;model.beat_division=new_beat_division;var time_division_milli_seconds=BPMtoMilliSeconds(model.BPM)/new_beat_division;interval=time_division_milli_seconds;expected=Date.now()+interval;audio_queue_index=audio_queue_index/old_length*audio_controller.audio_queue.length;audio_controller.timer_id=setTimeout(step,interval)}else{expected+=interval;audio_controller.timer_id=setTimeout(step,Math.max(0,interval-drift))}}}};function play_audio_string_sequence(audio_string_array){var j;for(j=0;j<audio_string_array.length;j++){audio_controller.preloaded_audio[j].setAttribute("src",audio_string_array[j]);audio_controller.preloaded_audio[j].volume=model.speak_volume}var i=j;for(i=0;i<audio_controller.preloaded_audio.length;i++){audio_controller.preloaded_audio[j].removeAttribute("src")}play_audio_sequence(audio_controller.preloaded_audio);function play_audio_sequence(){var i=0;var repeat_function=function(){audio_controller.preloaded_audio[i].removeEventListener("ended",repeat_function);i=i+1;if(i<audio_string_array.length){audio_controller.preloaded_audio[i].addEventListener("ended",repeat_function);audio_controller.preloaded_audio[i].play()}};var j=0;for(j=0;j<audio_controller.preloaded_audio.length;j++){audio_controller.preloaded_audio[j].removeEventListener("ended",repeat_function)}audio_controller.preloaded_audio[i].addEventListener("ended",repeat_function);audio_controller.preloaded_audio[i].play()}}function playFile(file){var audio=audio_controller.preloaded_audio[0];audio.setAttribute("src",file);audio.volume=model.speak_volume;audio.play()}function playNoteName(note){var note_name=note.note_name;if(note_name.is_sharp_or_flat){play_audio_string_sequence(note_name.file_name)}else{playFile(note_name.file_name)}}function playInterval(interval){var audio_file_names=[interval.audio_file_name];if(interval.play_type==musicKit.Interval.PLAY_TYPE.ASCENDING){audio_file_names.push("audio/intervals/ascending.mp3")}else if(interval.play_type==musicKit.Interval.PLAY_TYPE.DESCENDING){audio_file_names.push("audio/intervals/descending.mp3")}play_audio_string_sequence(audio_file_names)}function playChord(chord){play_audio_string_sequence(chord.file_name)}var type=TYPE.SINGLE_NOTE;function getAudioType(){var audio_types=[];if(model.single_notes.enabled)audio_types.push(TYPE.SINGLE_NOTE);if(model.interval.enabled)audio_types.push(TYPE.INTERVAL);if(model.chords.enabled)audio_types.push(TYPE.CHORD);if(audio_types.count==0)return TYPE.SINGLE_NOTE;var rand=randomInteger(0,audio_types.length-1);return audio_types[rand]}audio_controller.executeAudioTimer=function(index,accent_audio,audio_queue,text_queue,time_division_milli_seconds){if(audio_controller.index%2!=0){if(isDurationExpired()){forceStop();update_UI_stopped();clearInterval(audio_controller.timer_id);hideAnswer();return}type=getAudioType()}if(type==TYPE.SINGLE_NOTE){executeSingleNote()}else if(type==TYPE.INTERVAL){executeInterval()}else if(type==TYPE.CHORD){executeChord()}else{log.e("unknown type");executeSingleNote()}audio_controller.index=audio_controller.index+1;function executeSingleNote(){if(audio_controller.index%2==0){var note=audio_controller.note;showNoteAnswer(note);if(model.speak){playNoteName(note)}fretboardView.clear();fretboardView.drawNote(note);pianoView.clear();pianoView.drawNote(note)}else{hideAnswer();audio_controller.note=musicKit.Note.getRandom(musicKit.all_notes,musicKit.guitar_range)}midi_controller.playNote(audio_controller.note,time_division_milli_seconds/1e3)}function executeInterval(){if(audio_controller.index%2==0){var interval=audio_controller.interval;showIntervalAnswer(interval);if(model.speak){playInterval(interval)}fretboardView.clear();fretboardView.drawInterval(interval);pianoView.clear();pianoView.drawInterval(interval)}else{hideAnswer();audio_controller.interval=musicKit.Interval.generateRandom(musicKit.all_notes,musicKit.guitar_range,model.interval.types,model.interval.play_types)}midi_controller.playInterval(audio_controller.interval)}function executeChord(){if(audio_controller.index%2==0){var chord=audio_controller.chord;showChordAnswer(chord);if(model.speak){playChord(chord)}fretboardView.drawChord(chord);pianoView.clear();pianoView.drawChord(chord)}else{hideAnswer();let chord_types=model.chords.three_note_types.concat(model.chords.four_note_types);audio_controller.chord=musicKit.Chord.generateRandom(musicKit.all_notes,musicKit.guitar_range,chord_types,model.chords.play_types,model.chords.three_note_inversion_types,model.chords.four_note_inversion_types)}midi_controller.playChord(audio_controller.chord)}};var alert={};alert.init=function(){$("alert_container").addEventListener("click",function(event){alert.dismiss()});$("dismiss_alert_button").addEventListener("click",function(event){alert.dismiss()});$("alert").addEventListener("click",function(event){event.stopPropagation();return false})};alert.show=function(title,contents){$("alert_title").innerHTML=title;$("alert_contents").innerHTML=contents;$("alert_container").style.display="block"};alert.dismiss=function(){$("alert_container").style.display="none"};var information={};information.showAlert=function(){let contents='<br class="desktop-only" />'+'<p id="openMailToDeveloper">Thank you for using this website. If you wish to submit feedback, comment or report an error click <strong>here</strong></p>'+"<br/>"+'<p id="surikov">Special thanks to Surikov for their <strong>WebAudioFont</strong> library.</p>'+"<br/>"+'<p id="personalWebsite">Information about the developer can be found <strong>here</strong>.</p>'+"<br/>"+'<p id="musicAppWebsite">Other music apps created by this developer can be found <strong>here</strong>.</p>'+'<br class="desktop-only"/>'+'<button class="desktop-only" id="keyboard_shortcuts">Keyboard Shortcuts</button>';alert.show("Information",contents);information.setupOnClicks()};information.setupOnClicks=function(){$("openMailToDeveloper").onclick=function(){openMailToDeveloper()};$("surikov").onclick=function(){openURL("https://surikov.github.io/webaudiofont/")};$("personalWebsite").onclick=function(){openURL("https://jasonfleischer.github.io/website/")};$("musicAppWebsite").onclick=function(){openURL("https://jasonfleischer.github.io/music-apps/")};$("keyboard_shortcuts").onclick=function(){show_keyboard_shortcuts()}};information.dismissAlert=function(){alert.dismiss()};function setup_keyboard_listeners(){document.addEventListener("keyup",function(event){var code=event.code;if(code==="Space"){var play_button=is_compact_window()?$("mobile_play_pause_button"):$("play_pause_button");if(document.activeElement!==play_button){playPause();play_button.focus()}}function setBPM(bpm){model.BPM=bpm;log.i("on BPM change: "+model.BPM);range_control.load(range_control.on_range_control_changed,"",MIN_BPM,MAX_BPM,1,model.BPM,false,0);storage.set_BPM(model.BPM);update_UI_BPM(model.BPM);reloadBPM()}function decrementDivision(){var new_division;if(new_beat_division==0){new_division=Math.max(model.beat_division-1,1)}else{new_division=Math.max(new_beat_division-1,1)}$("division_select").value=new_division;reloadDivisions(new_division)}function incrementDivision(){var new_division;if(new_beat_division==0){new_division=Math.min(model.beat_division+1,4)}else{new_division=Math.min(new_beat_division+1,4)}$("division_select").value=new_division;reloadDivisions(new_division)}})}function show_keyboard_shortcuts(){dismissInfo();var keyboard_shorcut_window=window.open("Keyboard Shortcuts","_blank","width=370,height=450,titlebar=no,toolbar=no,status=no,location=no,menubar=no");keyboard_shorcut_window.document.title="Keyboard Shortcuts";var contents="<table style='width:100%; text-align: left;'>"+"<tr><th>Key</th><th>Command</th></tr>"+"<tr><td>Space</td><td>Play or stop</td></tr>"+"</table>";contents=contents.replaceAll("< tr>","<tr>");keyboard_shorcut_window.document.write(contents)}var midi_controller={duration_in_sec:3.5,tone:{},audioContext:{},player:{},tone:getJCLive()};midi_controller.init=function(){midi_controller.player=new WebAudioFontPlayer};var midi_initialized=false;var AudioContextFunc=window.AudioContext||window.webkitAudioContext;midi_controller.load=function(){if(!midi_initialized){midi_controller.audioContext=new AudioContextFunc;midi_controller.player.adjustPreset(midi_controller.audioContext,midi_controller.tone);midi_initialized=true;return true}return false};midi_controller.playNote=function(note,duration_in_sec=3.5){this.player.queueWaveTable(this.audioContext,this.audioContext.destination,this.tone,this.audioContext.currentTime,note.midi_value,this.duration_in_sec,model.volume)};midi_controller.playInterval=function(interval,duration_in_sec=3.5){var lower_note=interval.lower_note;var higher_note=interval.getHigherNote(musicKit.all_notes);var play_type=interval.play_type;var delay_between_notes=this.audioContext.currentTime+interval.delay_in_ms/1e3;if(play_type==musicKit.Interval.PLAY_TYPE.HARMONIC){this.player.queueWaveTable(this.audioContext,this.audioContext.destination,this.tone,0,lower_note.midi_value,this.duration_in_sec,model.volume);this.player.queueWaveTable(this.audioContext,this.audioContext.destination,this.tone,0,higher_note.midi_value,this.duration_in_sec,model.volume)}else if(play_type==musicKit.Interval.PLAY_TYPE.DESCENDING){this.player.queueWaveTable(this.audioContext,this.audioContext.destination,this.tone,0,higher_note.midi_value,this.duration_in_sec,model.volume);this.player.queueWaveTable(this.audioContext,this.audioContext.destination,this.tone,delay_between_notes,lower_note.midi_value,this.duration_in_sec,model.volume)}else{this.player.queueWaveTable(this.audioContext,this.audioContext.destination,this.tone,0,lower_note.midi_value,duration_in_sec,model.volume);this.player.queueWaveTable(this.audioContext,this.audioContext.destination,this.tone,delay_between_notes,higher_note.midi_value,this.duration_in_sec,model.volume)}};midi_controller.playChord=function(chord,duration_in_sec=3.5){var delay=this.audioContext.currentTime;let note_array=chord.getNoteArray(musicKit.all_notes,model.range);var i;for(i=0;i<note_array.length;i++){var note=note_array[i];this.player.queueWaveTable(this.audioContext,this.audioContext.destination,this.tone,delay,note.midi_value,this.duration_in_sec,model.volume);if(chord.play_type==musicKit.Chord.PLAY_TYPE.ARPEGGIATE){delay=delay+chord.delay_in_ms/1e3}}};var window_resize_start_event_occured=false;var resized_timer;window.onresize=function(){clearTimeout(resized_timer);resized_timer=setTimeout(window_resized_end,200);if(!window_resize_start_event_occured){window_resized_start();window_resize_start_event_occured=true}};function window_resized_start(){dismissInfo()}function window_resized_end(){window_resize_start_event_occured=false;$("content_view").style.visibility="visible";if(is_compact_window()){hide_settings();$("hide_show_left_column").style.visibility="hidden";$("content_view").style.marginLeft="0px"}else{$("hide_show_left_column").style.visibility="visible";if(is_left_column_showing){$("nav-side-menu").style.display="block";var column_width=getComputedStyle(document.documentElement).getPropertyValue("--left-column-width");$("content_view").style.marginLeft=column_width}else{$("nav-side-menu").style.display="none";$("content_view").style.marginLeft="0px"}}var column_width=parseInt($("content_view").style.marginLeft.replace("px",""));let contentWidth=document.body.clientWidth-column_width;$("init_view").style.width=contentWidth+"px";$("answer_container").style.width=contentWidth+"px";if(!audio_controller.playing){$("status_msg").style.display="block"}let fretboardPaddingLeftRight=34;fretboardView.resize(Math.min(contentWidth-fretboardPaddingLeftRight,1e3));let pianoPaddingLeftRight=30;pianoView.resize(Math.min(contentWidth-pianoPaddingLeftRight,1e3))}function setup_controls(){setup_onclicks();setup_select_controls();setup_sliders_controls();setup_switches_controls();setup_multiple_select_controls();function setup_onclicks(){$("page_name").onclick=function(){info()};$("kofi_button").onclick=function(){kofi()};$("info_button").onclick=function(){info()};$("setting_button").onclick=function(){toggle_settings()};$("play_pause_button").onclick=function(){playPause()};$("mobile_play_pause_button").onclick=function(){playPause()};setup_left_column_hide_close();setup_settings_menu_on_click();function setup_left_column_hide_close(){$("hide_show_left_column").addEventListener("click",function(event){if(is_left_column_showing){$("hide_show_left_column_img").src="img/right_chevron_white.svg"}else{$("hide_show_left_column_img").src="img/left_chevron_white.svg"}is_left_column_showing=!is_left_column_showing;window_resized_end()})}function setup_settings_menu_on_click(){$("ul_wrapper").addEventListener("click",function(event){if(is_compact_window())hide_settings()});$("nav-menu-ul").addEventListener("click",function(event){event.stopPropagation();return false})}}function setup_select_controls(){setup_duration_select();setup_instrument_select();function setup_duration_select(){const id="duration_select";$(id).addEventListener("change",function(e){var value=parseInt(this.value);log.i("on "+id+": "+value);model.duration=value;storage.set_duration(value);durationStartTime=new Date;audio_controller.reloadDuration();update_UI_duration(model.duration*6e4)});$(id).value=model.duration;update_UI_duration(model.duration*6e4)}function setup_instrument_select(){const id="instrument_select";$(id).addEventListener("change",function(e){var value=parseInt(this.value);log.i("on "+id+": "+value);model.instrument=value;storage.set_instrument(value);audio_controller.setInstrument(model.instrument)});$(id).value=model.instrument;audio_controller.setInstrument(model.instrument)}}function setup_sliders_controls(){setup_bpm_controls();setup_volume_control();setup_speak_volume_control();function setup_bpm_controls(){var min=MIN_BPM;var max=MAX_BPM;var step=1;setup_bpm_range(min,max,step);$("speed_text").innerHTML=(BPMtoMilliSeconds(model.BPM)/1e3).toFixed(1)+"s";function setup_bpm_range(min,max,step){var bpm_range=$("bpm_range");bpm_range.min=min;bpm_range.max=max;bpm_range.value=model.BPM;bpm_range.step=step;bpm_range.addEventListener("change",function(e){model.BPM=parseFloat(this.value);log.i("on BPM range change: "+model.BPM);storage.set_BPM(model.BPM);update_UI_BPM(model.BPM);reloadBPM()});bpm_range.addEventListener("input",function(){model.BPM=parseFloat(this.value);log.i("on BPM range change: "+model.BPM);storage.set_BPM(model.BPM);update_UI_BPM(model.BPM);reloadBPM()},true)}}function setup_volume_control(){var min=.05;var max=.5;var step=.05;setup_volume_range(min,max,step);function setup_volume_range(min,max,step){var range=$("volume_range");range.min=min;range.max=max;range.value=model.volume;range.step=step;range.addEventListener("change",function(e){model.volume=parseFloat(this.value);log.i("on Volume range change: "+model.volume);storage.set_volume(model.volume);update_UI_volume(model.volume)});range.addEventListener("input",function(){model.volume=parseFloat(this.value);log.i("on Volume range change: "+model.volume);storage.set_volume(model.volume);update_UI_volume(model.volume)},true)}}function setup_speak_volume_control(){var min=.1;var max=1;var step=.05;setup_volume_range(min,max,step);function setup_volume_range(min,max,step){var range=$("speak_volume_range");range.min=min;range.max=max;range.value=model.speak_volume;range.step=step;range.addEventListener("change",function(e){model.speak_volume=parseFloat(this.value);log.i("on Speak Volume range change: "+model.speak_volume);storage.set_speak_volume(model.speak_volume);update_UI_speak_volume(model.speak_volume)});range.addEventListener("input",function(){model.speak_volume=parseFloat(this.value);log.i("on Speak Volume range change: "+model.speak_volume);storage.set_speak_volume(model.speak_volume);update_UI_speak_volume(model.speak_volume)},true)}}}function setup_switches_controls(){setup_speak_switch();setup_single_notes_switch();setup_interval_switch();setup_chords_switch();function setup_speak_switch(){$("speak").addEventListener("click",function(e){$("speak_checkbox").click()});$("speak_checkbox_switch").addEventListener("keyup",function(e){if(event.code==="Space"||event.code==="Enter")$("speak_checkbox").click()});$("speak_checkbox").addEventListener("change",function(e){var value=this.checked;log.i("on speak change: "+value);model.speak=value;storage.set_speak(value);update_UI_speak()});$("speak_checkbox").checked=model.speak}function setup_single_notes_switch(){$("single_notes").addEventListener("click",function(e){$("single_notes_checkbox").click()});$("single_notes_checkbox_switch").addEventListener("keyup",function(e){if(event.code==="Space"||event.code==="Enter")$("ssingle_notes_checkbox").click()});$("single_notes_checkbox").addEventListener("change",function(e){var value=this.checked;log.i("on single notes change: "+value);model.single_notes.enabled=value;storage.set_single_notes(value)});$("single_notes_checkbox").checked=model.single_notes.enabled}function setup_interval_switch(){$("intervals").addEventListener("click",function(e){$("intervals_checkbox").click()});$("intervals_checkbox_switch").addEventListener("keyup",function(e){if(event.code==="Space"||event.code==="Enter")$("speak_checkbox").click()});$("intervals_checkbox").addEventListener("change",function(e){var value=this.checked;log.i("on intervals change: "+value);model.interval.enabled=value;storage.set_intervals(value);update_UI_intervals()});$("intervals_checkbox").checked=model.interval.enabled;update_UI_intervals()}function setup_chords_switch(){$("chords").addEventListener("click",function(e){$("chords_checkbox").click()});$("chords_checkbox_switch").addEventListener("keyup",function(e){if(event.code==="Space"||event.code==="Enter")$("chords_checkbox").click()});$("chords_checkbox").addEventListener("change",function(e){var value=this.checked;log.i("on chords change: "+value);model.chords.enabled=value;storage.set_chords(value);update_UI_chords()});$("chords_checkbox").checked=model.chords.enabled;update_UI_chords()}}function setup_multiple_select_controls(){setup_display_diagrams_multiple_select();setup_interval_type_multiple_select();setup_interval_play_type_multiple_select();setup_chord_three_note_multiple_select();setup_chord_three_note_inversion_multiple_select();setup_chord_four_note_multiple_select();setup_chord_four_note_inversion_multiple_select();setup_chord_play_type_multiple_select();function setup_display_diagrams_multiple_select(){var element_id_to_value_pairs=[["grid-item-display_diagrams_piano",DISPLAY_DIAGRAM.PIANO],["grid-item-display_diagrams_guitar",DISPLAY_DIAGRAM.GUITAR]];for(i=0;i<element_id_to_value_pairs.length;i++){var pair=element_id_to_value_pairs[i];update_UI_display_diagram(pair);setupDisplayDiagramClickListener(pair)}function setupDisplayDiagramClickListener(pair){var id=pair[0];var value=pair[1];$(id).addEventListener("click",function(e){var enabled=model.display_diagrams.includes(value);if(model.display_diagrams.length==1&&enabled){log.i("prevent no selection");return}if(enabled)model.display_diagrams.remove(value);else model.display_diagrams.push(value);log.i("on display diagram change: "+model.display_diagrams);storage.set_display_diagrams(value,!enabled);update_UI_display_diagram(pair)})}}function setup_interval_type_multiple_select(){let INTERVAL_TYPE=musicKit.Interval.TYPE;var element_id_type_pairs=[["grid-item-m2",INTERVAL_TYPE.MINOR_SECOND],["grid-item-M2",INTERVAL_TYPE.MAJOR_SECOND],["grid-item-m3",INTERVAL_TYPE.MINOR_THIRD],["grid-item-M3",INTERVAL_TYPE.MAJOR_THIRD],["grid-item-p4",INTERVAL_TYPE.PERFECT_FOURTH],["grid-item-tt",INTERVAL_TYPE.TRITONE],["grid-item-p5",INTERVAL_TYPE.PERFECT_FIFTH],["grid-item-m6",INTERVAL_TYPE.MINOR_SIXTH],["grid-item-M6",INTERVAL_TYPE.MAJOR_SIXTH],["grid-item-m7",INTERVAL_TYPE.MINOR_SEVENTH],["grid-item-M7",INTERVAL_TYPE.MAJOR_SEVENTH],["grid-item-p8",INTERVAL_TYPE.OCTAVE]];for(i=0;i<element_id_type_pairs.length;i++){var pair=element_id_type_pairs[i];update_UI_interval_type(pair);setupIntervalTypeClickListener(pair)}function setupIntervalTypeClickListener(pair){var id=pair[0];var type=pair[1];$(id).addEventListener("click",function(e){var type_enabled=model.interval.types.includes(type);if(model.interval.types.length==1&&type_enabled){log.i("prevent no selection");return}if(type_enabled)model.interval.types.remove(type);else model.interval.types.push(type);log.i("on interval type change: "+model.interval.types);storage.set_interval_type(type,!type_enabled);update_UI_interval_type(pair)})}}function setup_interval_play_type_multiple_select(){let INTERVAL_PLAY_TYPE=musicKit.Interval.PLAY_TYPE;var element_id_play_type_pairs=[["grid-item-ascending",INTERVAL_PLAY_TYPE.ASCENDING],["grid-item-descending",INTERVAL_PLAY_TYPE.DESCENDING],["grid-item-harmonic",INTERVAL_PLAY_TYPE.HARMONIC]];for(i=0;i<element_id_play_type_pairs.length;i++){var pair=element_id_play_type_pairs[i];update_UI_interval_play_type(pair);setupIntervalPlayTypeClickListener(pair)}function setupIntervalPlayTypeClickListener(pair){var id=pair[0];var type=pair[1];$(id).addEventListener("click",function(e){var type_enabled=model.interval.play_types.includes(type);if(model.interval.play_types.length==1&&type_enabled){log.i("prevent no selection");return}if(type_enabled)model.interval.play_types.remove(type);else model.interval.play_types.push(type);log.i("on interval type change: "+model.interval.play_types);storage.set_interval_play_type(type,!type_enabled);update_UI_interval_play_type(pair)})}}function setup_chord_three_note_multiple_select(){var element_id_play_type_pairs=[["grid-item-min",musicKit.Chord.TYPE.minor],["grid-item-maj",musicKit.Chord.TYPE.Major],["grid-item-aug",musicKit.Chord.TYPE.Aug],["grid-item-dim",musicKit.Chord.TYPE.Dim]];for(i=0;i<element_id_play_type_pairs.length;i++){var pair=element_id_play_type_pairs[i];update_UI_chord_three_note_type(pair);setupClickListener(pair)}function setupClickListener(pair){var id=pair[0];var type=pair[1];$(id).addEventListener("click",function(e){var type_enabled=model.chords.three_note_types.includes(type);if(model.chords.three_note_types.length+model.chords.four_note_types.length==1&&type_enabled){log.i("prevent no selection");return}if(type_enabled)model.chords.three_note_types.remove(type);else model.chords.three_note_types.push(type);log.i("on chords three_note_types change: "+model.chords.three_note_types);storage.set_chord_three_note_type(type,!type_enabled);update_UI_chord_three_note_type(pair)})}}function setup_chord_three_note_inversion_multiple_select(){var element_id_play_type_pairs=[["grid-item-three_note_root",musicKit.Chord.INVERSION_TYPE.Root],["grid-item-three_note_first",musicKit.Chord.INVERSION_TYPE.First],["grid-item-three_note_second",musicKit.Chord.INVERSION_TYPE.Second]];for(i=0;i<element_id_play_type_pairs.length;i++){var pair=element_id_play_type_pairs[i];update_UI_chord_three_note_inversion_type(pair);setupClickListener(pair)}function setupClickListener(pair){var id=pair[0];var type=pair[1];$(id).addEventListener("click",function(e){var type_enabled=model.chords.three_note_inversion_types.includes(type);if(model.chords.three_note_inversion_types.length==1&&type_enabled){log.i("prevent no selection");return}if(type_enabled)model.chords.three_note_inversion_types.remove(type);else model.chords.three_note_inversion_types.push(type);log.i("on chords three_note_inversion_types change: "+model.chords.three_note_inversion_types);storage.set_chord_three_note_inversion_type(type,!type_enabled);update_UI_chord_three_note_inversion_type(pair)})}}function setup_chord_four_note_multiple_select(){var element_id_play_type_pairs=[["grid-item-maj-seventh",musicKit.Chord.TYPE.Major7],["grid-item-min-seventh",musicKit.Chord.TYPE.minor7],["grid-item-dominant-seventh",musicKit.Chord.TYPE.Dom7]];for(i=0;i<element_id_play_type_pairs.length;i++){var pair=element_id_play_type_pairs[i];update_UI_chord_four_note_type(pair);setupClickListener(pair)}function setupClickListener(pair){var id=pair[0];var type=pair[1];$(id).addEventListener("click",function(e){var type_enabled=model.chords.four_note_types.includes(type);if(model.chords.three_note_types.length+model.chords.four_note_types.length==1&&type_enabled){log.i("prevent no selection");return}if(type_enabled)model.chords.four_note_types.remove(type);else model.chords.four_note_types.push(type);log.i("on chords four_note_types change: "+model.chords.four_note_types);storage.set_chord_four_note_type(type,!type_enabled);update_UI_chord_four_note_type(pair)})}}function setup_chord_four_note_inversion_multiple_select(){var element_id_play_type_pairs=[["grid-item-four_note_root",musicKit.Chord.INVERSION_TYPE.Root],["grid-item-four_note_first",musicKit.Chord.INVERSION_TYPE.First],["grid-item-four_note_second",musicKit.Chord.INVERSION_TYPE.Second],["grid-item-four_note_third",musicKit.Chord.INVERSION_TYPE.Third]];for(i=0;i<element_id_play_type_pairs.length;i++){var pair=element_id_play_type_pairs[i];update_UI_chord_four_note_inversion_type(pair);setupClickListener(pair)}function setupClickListener(pair){var id=pair[0];var type=pair[1];$(id).addEventListener("click",function(e){var type_enabled=model.chords.four_note_inversion_types.includes(type);if(model.chords.four_note_inversion_types.length==1&&type_enabled){log.i("prevent no selection");return}if(type_enabled)model.chords.four_note_inversion_types.remove(type);else model.chords.four_note_inversion_types.push(type);log.i("on chords four_note_inversion_types change: "+model.chords.four_note_inversion_types);storage.set_chord_four_note_inversion_type(type,!type_enabled);update_UI_chord_four_note_inversion_type(pair)})}}function setup_chord_play_type_multiple_select(){var element_id_play_type_pairs=[["grid-item-chord-harmonic",musicKit.Chord.PLAY_TYPE.HARMONIC],["grid-item-chord-arpeggiate",musicKit.Chord.PLAY_TYPE.ARPEGGIATE]];for(i=0;i<element_id_play_type_pairs.length;i++){var pair=element_id_play_type_pairs[i];update_UI_chord_play_type(pair);setupChordPlayTypeClickListener(pair)}function setupChordPlayTypeClickListener(pair){var id=pair[0];var type=pair[1];$(id).addEventListener("click",function(e){var type_enabled=model.chords.play_types.includes(type);if(model.chords.play_types.length==1&&type_enabled){log.i("prevent no selection");return}if(type_enabled)model.chords.play_types.remove(type);else model.chords.play_types.push(type);log.i("on chords type change: "+model.chords.play_types);storage.set_chord_play_type(type,!type_enabled);update_UI_chord_play_type(pair)})}}}}const log=require("@jasonfleischer/log");const pianoKit=require("@jasonfleischer/piano");const fretboardKit=require("@jasonfleischer/fretboard");const musicKit=require("@jasonfleischer/music-model-kit");musicKit.init();let pianoView=pianoKit({id:"piano"});const fretboardView=fretboardKit({id:"fretboard",showLabels:false});function init(){storage.load();var isSafariMobile=window.mobileAndTabletCheck()&&isSafari;if(isSafariMobile&&!isFromHomeScreen()){install.showAlert()}midi_controller.init();setup_controls();setup_keyboard_listeners();alert.init();if(window.mobileAndTabletCheck()){setup_mobile();function setup_mobile(){$("hide_show_left_column").style.display="none"}}show_hidden_views();window_resized_end();function show_hidden_views(){$("header").style.display="block";if(!is_compact_window()){$("nav-side-menu").style.display="block";if(window.mobileCheck())$("hide_show_left_column").style.display="block"}$("init_view").style.visibility="visible";$("hide_show_left_column").style.visibility="visible"}}function kofi(){window.open("https://ko-fi.com/jasonfleischer","_blank")}function info(){information.showAlert()}function dismissInfo(){information.dismissAlert()}var settings_animation_id;function toggle_settings(){if($("nav-side-menu").style.display!=="block")show_settings();else hide_settings();function show_settings(){$("nav-side-menu").style.display="block";$("kofi_button").style.display="none";$("info_button").style.display="none";$("setting_button_svg").src="img/close_white.svg";settings_slide_down_animation();function settings_slide_down_animation(){var elem=$("nav-side-menu");var height=$("nav-menu-ul").offsetHeight;var pos=-1*height;settings_animation_id=setInterval(frame,10);elem.style.top=pos+"px";function frame(){if(pos==0){clearInterval(settings_animation_id)}else{pos=Math.min(pos+15,0);elem.style.top=pos+"px"}}}}}function hide_settings(){clearInterval(settings_animation_id);$("nav-side-menu").style.display="none";$("kofi_button").style.display="block";$("info_button").style.display="block";$("setting_button_svg").src="img/gear_white.svg"}function openMailToDeveloper(){var subject="Metronome Website Feedback";subject=subject.replaceAll(" ","%20");openURL("mailto:jason_fleischer@hotmail.ca?Subject="+subject)}function update_UI_BPM(value){var range=$("bpm_range");range.value=value;$("speed_text").innerHTML=(BPMtoMilliSeconds(value)/1e3).toFixed(1)+"s";function update_UI_tempo_marking(BPM){var tempo_marking="";if(BPM>=40&&BPM<60){tempo_marking="Largo"}else if(BPM>=60&&BPM<66){tempo_marking="Larghetto"}else if(BPM>=66&&BPM<76){tempo_marking="Adagio"}else if(BPM>=76&&BPM<108){tempo_marking="Andante"}else if(BPM>=98&&BPM<=112){tempo_marking="Moderato"}else if(BPM>112&&BPM<120){tempo_marking="Allegro moderato"}else if(BPM>=120&&BPM<=156){tempo_marking="Allegro"}else if(BPM>156&&BPM<168){tempo_marking="Vivace"}else if(BPM>=168&&BPM<200){tempo_marking="Presto"}else if(BPM>=200){tempo_marking="Prestissimo"}clearInterval(fadeEffect);var fadeTarget=$("tempo_marking");fadeTarget.style.opacity=1;var fadeEffect=setInterval(function(){if(!fadeTarget.style.opacity){fadeTarget.style.opacity=1}if(fadeTarget.style.opacity>0){fadeTarget.style.opacity-=.09}else{clearInterval(fadeEffect)}},100);$("tempo_marking").innerHTML=tempo_marking}}function update_UI_duration(duration_in_MS){var new_text;if(duration_in_MS<0)new_text=audio_controller.playing?"Stop":"Play";else{var time_display=" ("+human_readable_duration(duration_in_MS)+")";if(time_display==" ()"){time_display=""}new_text=(audio_controller.playing?"Stop":"Play")+"<span id='play_pause_button_span'>"+time_display+"</span>"}$("play_pause_button").innerHTML=new_text;$("mobile_play_pause_button").innerHTML=new_text;function human_readable_duration(duration_in_MS){var duration_in_seconds=duration_in_MS/1e3;if(duration_in_seconds<60){return formattedSeconds(duration_in_seconds)}else if(duration_in_seconds<60*60){var mins=parseInt(duration_in_seconds/60);var secs=duration_in_seconds-mins*60;return mins+" min"+(secs==0?"":" ")+formattedSeconds(secs)}else if(duration_in_seconds>=60*60){var hours=parseInt(duration_in_seconds/60/60);return hours+" hour"}else{LogE("not handled human readable duration");return""}function formattedSeconds(seconds){seconds=parseInt(seconds);if(seconds==0)return"";else if(seconds<10)return"0"+seconds+" s";else return seconds+" s"}}}function update_UI_volume(value){var range=$("volume_range");range.value=value}function update_UI_speak(){$("speak_volume").style.display=model.speak?"block":"none"}function update_UI_speak_volume(value){var range=$("speak_volume_range");range.value=value}function update_UI_display_diagram(pair){const id=pair[0];const value=pair[1];const isIncluded=model.display_diagrams.includes(value);if(isIncluded)$(id).classList.add("enabled");else $(id).classList.remove("enabled");if(value==DISPLAY_DIAGRAM.PIANO){$(pianoView.id).style.display=isIncluded?"block":"none"}else if(value==DISPLAY_DIAGRAM.GUITAR){$(fretboardView.id).style.display=isIncluded?"block":"none"}}function update_UI_intervals(){if(model.interval.enabled){$("grid-container-interval_types").style.display="grid";$("grid-container-interval_play_types").style.display="grid"}else{$("grid-container-interval_types").style.display="none";$("grid-container-interval_play_types").style.display="none"}}function update_UI_interval_type(pair){var id=pair[0];var type=pair[1];if(model.interval.types.includes(type))$(id).classList.add("enabled");else $(id).classList.remove("enabled")}function update_UI_interval_play_type(pair){var id=pair[0];var type=pair[1];if(model.interval.play_types.includes(type))$(id).classList.add("enabled");else $(id).classList.remove("enabled")}function update_UI_chords(){if(model.chords.enabled){$("grid-container-chords_three_note").style.display="grid";$("grid-container-chords_four_note").style.display="grid";$("grid-container-chords_play_type").style.display="grid"}else{$("grid-container-chords_three_note").style.display="none";$("grid-container-chords_four_note").style.display="none";$("grid-container-chords_play_type").style.display="none"}}function update_UI_chord_play_type(pair){var id=pair[0];var type=pair[1];if(model.chords.play_types.includes(type))$(id).classList.add("enabled");else $(id).classList.remove("enabled")}function update_UI_chord_three_note_type(pair){var id=pair[0];var type=pair[1];if(model.chords.three_note_types.includes(type))$(id).classList.add("enabled");else $(id).classList.remove("enabled");var inversionIds=["grid-item-three_note_root","grid-item-three_note_first","grid-item-three_note_second"];var i;for(i=0;i<inversionIds.length;i++){$(inversionIds[i]).style.display=model.chords.three_note_types.length==0?"none":"block"}}function update_UI_chord_three_note_inversion_type(pair){var id=pair[0];var type=pair[1];if(model.chords.three_note_inversion_types.includes(type))$(id).classList.add("enabled");else $(id).classList.remove("enabled")}function update_UI_chord_four_note_type(pair){var id=pair[0];var type=pair[1];if(model.chords.four_note_types.includes(type))$(id).classList.add("enabled");else $(id).classList.remove("enabled");var inversionIds=["grid-item-four_note_root","grid-item-four_note_first","grid-item-four_note_second","grid-item-four_note_third"];var i;for(i=0;i<inversionIds.length;i++){$(inversionIds[i]).style.display=model.chords.four_note_types.length==0?"none":"block"}}function update_UI_chord_four_note_inversion_type(pair){var id=pair[0];var type=pair[1];if(model.chords.four_note_inversion_types.includes(type))$(id).classList.add("enabled");else $(id).classList.remove("enabled")}function update_UI_playing(){$("play_pause_button").innerHTML="Stop";$("mobile_play_pause_button").innerHTML="Stop";$("status_msg").innerHTML="What musical sound are you hearing?";startDurationTimer()}var durationTimer;var durationStartTime;function startDurationTimer(){durationStartTime=new Date;update_UI_duration(model.duration*6e4);durationTimer=setInterval(function(){var now=new Date;var diff=parseInt(now-durationStartTime);update_UI_duration(model.duration*6e4-diff)},500)}function update_UI_stopped(){update_UI_duration(model.duration*6e4);$("status_msg").innerHTML="Configure then press 'Play' to begin";$("init_view").style.visibility="visible";hideAnswer();stopDurationTimer()}function stopDurationTimer(){clearTimeout(durationTimer)}function hideAnswer(){$("init_view").style.visibility="visible";$("note_display").style.visibility="hidden";$("interval_display").style.visibility="hidden";$("chord_display").style.visibility="hidden";$("fretboard").style.visibility="hidden";$("piano").style.visibility="hidden";$("answer_container").style.visibility="hidden"}function showNoteAnswer(note){update_UI_note("note",note);$("init_view").style.visibility="hidden";$("note_display").style.visibility="visible";$("interval_display").style.visibility="hidden";$("chord_display").style.visibility="hidden";$("fretboard").style.visibility="visible";$("piano").style.visibility="visible";$("answer_container").style.visibility="visible"}function update_UI_note(id_prefix,note){$(id_prefix+"_name").innerHTML=is_compact_window()?note.note_name.type.substring(0,2):note.note_name.type;$(id_prefix+"_octave").innerHTML=note.octave;$(id_prefix+"_color").style.backgroundColor=note.note_name.color;var gray_scale_percent=(note.midi_value-21)/(108-21);function hexToRgb(hex){var result=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(hex);return result?{r:parseInt(result[1],16),g:parseInt(result[2],16),b:parseInt(result[3],16)}:null}$(id_prefix+"_color").style.borderColor="rgba(1,1,1,"+(1-gray_scale_percent)+")"}function showIntervalAnswer(interval){let INTERVAL_PLAY_TYPE=musicKit.Interval.PLAY_TYPE;update_UI_note("first_note",interval.play_type==musicKit.Interval.PLAY_TYPE.ASCENDING?interval.lower_note:interval.getHigherNote(musicKit.all_notes));update_UI_note("second_note",interval.play_type==musicKit.Interval.PLAY_TYPE.ASCENDING?interval.getHigherNote(musicKit.all_notes):interval.lower_note);$("interval_type").innerHTML=interval.type+":";if(interval.play_type==musicKit.Interval.PLAY_TYPE.ASCENDING){$("interval_play_type_img").style.display="block";$("interval_play_type_img").src="img/up_arrow_white.svg";$("interval_play_type").innerHTML=""}else if(interval.play_type==musicKit.Interval.PLAY_TYPE.DESCENDING){$("interval_play_type_img").style.display="block";$("interval_play_type_img").src="img/down_arrow_white.svg";$("interval_play_type").innerHTML=""}else{$("interval_play_type_img").style.display="none";$("interval_play_type").innerHTML="&"}$("init_view").style.visibility="hidden";$("note_display").style.visibility="hidden";$("interval_display").style.visibility="visible";$("chord_display").style.visibility="hidden";$("fretboard").style.visibility="visible";$("piano").style.visibility="visible";$("answer_container").style.visibility="visible"}function showChordAnswer(chord){$("chord_name").innerHTML=chord.name;$("chord_structure").innerHTML=is_compact_window()?"":"("+chord.structure+")";$("chord_inversion").innerHTML=chord.inversion==musicKit.Chord.INVERSION_TYPE.Root?"":chord.inversion;$("init_view").style.visibility="hidden";$("note_display").style.visibility="hidden";$("interval_display").style.visibility="hidden";$("chord_display").style.visibility="visible";$("fretboard").style.visibility="visible";$("piano").style.visibility="visible";$("answer_container").style.visibility="visible"}var install={prompt:{}};if("serviceWorker"in navigator){navigator.serviceWorker.register("/eartrainer/service_worker.js",{scope:"/eartrainer/"}).then(function(reg){if(reg.installing){console.log("eartrainer: Service worker installing")}else if(reg.waiting){console.log("eartrainer: Service worker installed")}else if(reg.active){console.log("eartrainer: Service worker active")}}).catch(function(error){console.log("Registration failed with "+error)})}else{console.log("Service worker not available")}window.onload=function(){init()};window.addEventListener("beforeinstallprompt",function(e){e.preventDefault();install.prompt=e;if(window.mobileAndTabletCheck()){install.showAlert(function(){install.prompt.prompt()})}});window.addEventListener("appinstalled",async function(e){alert.dismiss()});install.showAlert=function(install_action){let contents="<p>Install this app on your device to easily access it anytime. Installing this app will result in better performance, improved fullscreen experience, and usage without an internet connection.</p>"+"<br/>";var isSafariMobile=window.mobileAndTabletCheck()&&isSafari;if(isSafariMobile){contents+='<div id="ios_install_instructions">'+'<p>1. Tap on <img src="img/export.png" alt="export"/></p>'+"<p>2. Select 'Add to Home Screen'</p>"+"</div>"}else{contents+='<button id="install">Install</button>'}alert.show("Install App",contents);if(!isSafariMobile){let installButton=document.getElementById("install");installButton.addEventListener("click",install_action)}};let CACHE_NAME="v18";const CACHE=["/eartrainer/index.html","/eartrainer/fonts/SF_Pro_Display_Thin.woff2","/eartrainer/css/bundle.css","/eartrainer/js/midi/webAudioFontPlayer.js","/eartrainer/js/midi/midi_0000_JCLive_sf2_file.js","/eartrainer/js/bundle.js","/eartrainer/audio/chords/augmented.mp3","/eartrainer/audio/chords/diminished.mp3","/eartrainer/audio/chords/dominant_seventh.mp3","/eartrainer/audio/chords/major.mp3","/eartrainer/audio/chords/major_seventh.mp3","/eartrainer/audio/chords/minor.mp3","/eartrainer/audio/chords/minor_seventh.mp3","/eartrainer/audio/intervals/ascending.mp3","/eartrainer/audio/intervals/descending.mp3","/eartrainer/audio/intervals/fifth.mp3","/eartrainer/audio/intervals/fourth.mp3","/eartrainer/audio/intervals/major_2nd.mp3","/eartrainer/audio/intervals/major_3rd.mp3","/eartrainer/audio/intervals/major_6th.mp3","/eartrainer/audio/intervals/major_7th.mp3","/eartrainer/audio/intervals/minor_2nd.mp3","/eartrainer/audio/intervals/minor_3rd.mp3","/eartrainer/audio/intervals/minor_6th.mp3","/eartrainer/audio/intervals/minor_7th.mp3","/eartrainer/audio/intervals/octave.mp3","/eartrainer/audio/intervals/tritone.mp3"];self.addEventListener("install",function(event){console.log("eartrainer: install");event.waitUntil(caches.open(CACHE_NAME).then(function(cache){return cache.addAll(CACHE)}))});self.addEventListener("fetch",function(event){console.log("eartrainer: fetch");event.respondWith(caches.open(CACHE_NAME).then(function(cache){return cache.match(event.request).then(function(response){return response||fetch(event.request).then(function(response){cache.put(event.request,response.clone());return response})})}))});self.addEventListener("activate",function activator(event){console.log("eartrainer: activate");event.waitUntil(caches.keys().then(function(keys){return Promise.all(keys.filter(function(key){return key.indexOf(CACHE_NAME)!==0}).map(function(key){return caches.delete(key)}))}))});